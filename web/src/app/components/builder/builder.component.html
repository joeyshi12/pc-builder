<h1>PC Parts List</h1>
<p>Pick out your PC parts.</p>
<div *ngIf="draft$ | async as draft">
  <div class="build-table">
    <header>
      <div>
        <label>{{draft.displayName}}</label>
        <span>{{draft.description}}</span>
      </div>
      <div>
        <button (click)="isEditDraftOpen = true">Edit list</button>
        <button (click)="saveDraft(draft)">Save list</button>
      </div>
    </header>
    <table>
      <thead>
      <tr>
        <th>Component</th>
        <th>Name</th>
        <th>Price</th>
      </tr>
      </thead>
      <tbody *ngIf="componentListModels$ | async as componentListDefs">
        <ng-container *ngFor="let listDef of componentListDefs">
          <ng-container *ngIf="listDef.items.length > 0; else componentSelect">
            <tr>
              <td>
                <a routerLink="/component-listing"
                  [queryParams]="{component: listDef.componentType}">
                  {{listDef.displayName}}
                </a>
              </td>
              <td>
                <ul>
                  <li *ngFor="let item of listDef.items">
                    {{item.displayName}}
                  </li>
                </ul>
              </td>
              <td>
                <ul>
                  <li *ngFor="let item of listDef.items">
                    {{item.price}}
                  </li>
                </ul>
              </td>
            </tr>
          </ng-container>
          <ng-template #componentSelect>
            <tr>
              <td>
                <a routerLink="/component-listing" [queryParams]="{component: listDef.componentType}">{{listDef.displayName}}</a>
              </td>
              <td>
                <button
                  routerLink="/component-listing"
                  [queryParams]="{component: listDef.componentType}">Choose a {{listDef.displayName}} component</button>
              </td>
              <td></td>
            </tr>
          </ng-template>
        </ng-container>
      </tbody>
    </table>
  </div>

  <dialog [open]="isEditDraftOpen">
    <div>
      <div class="form-header">
        <h1>Edit Profile</h1>
      </div>
      <div class="form-body">
        <div class="form-field">
          <label>Display name</label>
          <input #displayName type="text" [value]="draft.displayName" />
        </div>
        <div class="form-field">
          <label>Description</label>
          <input #description type="text" [value]="draft.description" />
        </div>
        <div class="form-buttons-container">
          <button (click)="isEditDraftOpen = false">Close</button>
          <button (click)="updateDraftInfo(displayName.value, description.value)">Submit</button>
        </div>
      </div>
    </div>
  </dialog>
</div>
