<h1>PC Parts List</h1>
<p>Pick out your PC parts.</p>
<ng-container *ngIf="draft$ | async as draft">
  <div class="build-table">
    <header>
      <div class="basic-info">
        <label>{{draft.displayName}}</label>
        <span [title]="draft.description">{{draft.description}}</span>
      </div>
      <div class="action-buttons">
        <button *ngIf="isLoggedIn" (click)="isBuildListOpen = true">Switch list</button>
        <button (click)="isEditDraftOpen = true">Edit info</button>
        <button (click)="saveDraft(draft)">Save list</button>
      </div>
    </header>
    <table>
      <thead>
      <tr>
        <th>Component</th>
        <th>Name</th>
        <th>Price</th>
      </tr>
      </thead>
      <tbody *ngIf="componentListModels$ | async as componentListDefs">
        <ng-container *ngFor="let listDef of componentListDefs">
          <ng-container *ngIf="listDef.items.length > 0; else componentSelect">
            <tr>
              <td>
                <a routerLink="/component-listing"
                  [queryParams]="{component: listDef.componentType}">
                  {{listDef.displayName}}
                </a>
              </td>
              <td>
                <ol>
                  <li *ngFor="let item of listDef.items">
                    {{item.displayName}}
                  </li>
                </ol>
              </td>
              <td>
                <ol>
                  <li *ngFor="let item of listDef.items">
                    {{item.price}}
                  </li>
                </ol>
              </td>
            </tr>
          </ng-container>
          <ng-template #componentSelect>
            <tr>
              <td>
                <a routerLink="/component-listing" [queryParams]="{component: listDef.componentType}">{{listDef.displayName}}</a>
              </td>
              <td>
                <button
                  routerLink="/component-listing"
                  [queryParams]="{component: listDef.componentType}">Choose a {{listDef.displayName}} component</button>
              </td>
              <td></td>
            </tr>
          </ng-template>
        </ng-container>
      </tbody>
    </table>
  </div>

  <app-dialog [isOpen]="isBuildListOpen"
              title="PC Builds">
    <div class="form-body">
      <ag-grid-angular class="ag-theme-alpine"
                       [gridOptions]="gridOptions"
                       [columnDefs]="columnDefs"
                       [rowData]="buildList"
                       (gridColumnsChanged)="resizeGrid($event)"
                       (gridSizeChanged)="resizeGrid($event)"
                       (selectionChanged)="updateBuildSelection($event)">
      </ag-grid-angular>
      <div class="form-buttons-container">
        <button (click)="isBuildListOpen = false">Close</button>
        <button>Switch</button>
      </div>
    </div>
  </app-dialog>

  <app-dialog [isOpen]="isEditDraftOpen"
              title="Edit Profile">
    <div class="form-body">
      <div class="form-field">
        <label>Display name</label>
        <input #displayName type="text" [value]="draft.displayName" />
      </div>
      <div class="form-field">
        <label>Description</label>
        <input #description type="text" [value]="draft.description" />
      </div>
      <div class="form-buttons-container">
        <button (click)="isEditDraftOpen = false">Close</button>
        <button (click)="updateDraftInfo(displayName.value, description.value)">Submit</button>
      </div>
    </div>
  </app-dialog>
</ng-container>
