<h1>PC Parts List</h1>
<p>Pick out your PC parts.</p>
<ng-container *ngIf="draftBuild">
  <div class="build-table">
    <header>
      <div class="basic-info">
        <label>{{draftBuild.displayName}}</label>
        <span [title]="draftBuild.description">{{draftBuild.description}}</span>
      </div>
      <div class="action-buttons">
        <ng-container *ngIf="isLoggedIn">
          <button (click)="createNewDraft()">New build</button>
          <button (click)="isBuildListOpen = true">Switch list</button>
        </ng-container>
        <button (click)="isEditDraftOpen = true">Edit info</button>
      </div>
    </header>
    <table>
      <thead>
      <tr>
        <th>Component</th>
        <th>Name</th>
        <th>Price</th>
      </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let listDef of componentListModels">
          <ng-container *ngIf="listDef.items.length > 0; else componentSelect">
            <tr>
              <td>
                <a routerLink="/component-listing"
                  [queryParams]="{component: listDef.componentType}">
                  {{listDef.displayName}}
                </a>
              </td>
              <td>
                <ol>
                  <li *ngFor="let item of listDef.items">
                    {{item.displayName}}
                  </li>
                </ol>
              </td>
              <td>
                <ol>
                  <li *ngFor="let item of listDef.items">
                    {{item.price}}
                  </li>
                </ol>
              </td>
            </tr>
          </ng-container>
          <ng-template #componentSelect>
            <tr>
              <td>
                <a routerLink="/component-listing" [queryParams]="{component: listDef.componentType}">{{listDef.displayName}}</a>
              </td>
              <td>
                <button
                  routerLink="/component-listing"
                  [queryParams]="{component: listDef.componentType}">Choose a {{listDef.displayName}} component</button>
              </td>
              <td></td>
            </tr>
          </ng-template>
        </ng-container>
      </tbody>
    </table>
  </div>

  <app-dialog title="PC Builds"
              [isOpen]="isBuildListOpen"
              [widthRem]="40"
              (close)="isBuildListOpen = false">
    <div class="form-body">
      <ag-grid-angular class="ag-theme-alpine build-list"
                       [gridOptions]="gridOptions"
                       [columnDefs]="columnDefs"
                       [rowData]="userBuilds"
                       (gridColumnsChanged)="resizeGrid($event)"
                       (gridSizeChanged)="resizeGrid($event)"
                       (selectionChanged)="updateBuildSelection($event)">
      </ag-grid-angular>
      <div class="form-buttons-container">
        <button (click)="isBuildListOpen = false">Close</button>
        <button [disabled]="!hasSelectedBuild" (click)="switchBuild()">Switch</button>
      </div>
    </div>
  </app-dialog>

  <app-dialog title="Edit Profile"
              [isOpen]="isEditDraftOpen"
              (close)="isEditDraftOpen = false">
    <div class="form-body">
      <div class="form-field">
        <label>Display name</label>
        <input #displayName type="text" [value]="draftBuild.displayName" />
      </div>
      <div class="form-field">
        <label>Description</label>
        <input #description type="text" [value]="draftBuild.description" />
      </div>
      <div class="form-buttons-container">
        <button (click)="isEditDraftOpen = false">Close</button>
        <button (click)="updateDraftInfo(displayName.value, description.value)">Submit</button>
      </div>
    </div>
  </app-dialog>
</ng-container>
